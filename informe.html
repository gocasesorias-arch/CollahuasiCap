<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Certificados Médicos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    
    <!-- Lucide React Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        const { BarChart, Bar, PieChart, Pie, LineChart, Line, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
        const { Filter, Download, RefreshCw, AlertCircle, CheckCircle, Clock, TrendingUp, Users } = lucideReact;

        const DashboardCertificados = () => {
          // Datos de ejemplo más completos
          const [certificados] = useState([
            {
              id: 1,
              paciente: "Juan Pérez",
              rut: "12.345.678-9",
              diagnostico: "Faringitis Aguda",
              dias: 3,
              fechaInicio: "2024-01-15",
              fechaFin: "2024-01-17",
              estado: "vigente",
              medico: "Dr. García",
              especialidad: "Medicina General"
            },
            {
              id: 2,
              paciente: "María González",
              rut: "23.456.789-0",
              diagnostico: "Lumbalgia",
              dias: 5,
              fechaInicio: "2024-01-10",
              fechaFin: "2024-01-14",
              estado: "vencido",
              medico: "Dr. Rodríguez",
              especialidad: "Traumatología"
            },
            {
              id: 3,
              paciente: "Carlos Muñoz",
              rut: "34.567.890-1",
              diagnostico: "Gripe",
              dias: 2,
              fechaInicio: "2024-01-16",
              fechaFin: "2024-01-17",
              estado: "vigente",
              medico: "Dra. López",
              especialidad: "Medicina General"
            },
            {
              id: 4,
              paciente: "Ana Fernández",
              rut: "45.678.901-2",
              diagnostico: "Tendinitis",
              dias: 7,
              fechaInicio: "2024-01-08",
              fechaFin: "2024-01-14",
              estado: "vencido",
              medico: "Dr. Rodríguez",
              especialidad: "Traumatología"
            },
            {
              id: 5,
              paciente: "Pedro Silva",
              rut: "56.789.012-3",
              diagnostico: "Bronquitis",
              dias: 4,
              fechaInicio: "2024-01-14",
              fechaFin: "2024-01-17",
              estado: "vigente",
              medico: "Dra. Martínez",
              especialidad: "Medicina General"
            },
            {
              id: 6,
              paciente: "Laura Soto",
              rut: "67.890.123-4",
              diagnostico: "Esguince",
              dias: 10,
              fechaInicio: "2024-01-05",
              fechaFin: "2024-01-14",
              estado: "vencido",
              medico: "Dr. Rodríguez",
              especialidad: "Traumatología"
            },
            {
              id: 7,
              paciente: "Diego Vargas",
              rut: "78.901.234-5",
              diagnostico: "Gastroenteritis",
              dias: 3,
              fechaInicio: "2024-01-15",
              fechaFin: "2024-01-17",
              estado: "vigente",
              medico: "Dr. García",
              especialidad: "Medicina General"
            },
            {
              id: 8,
              paciente: "Carmen Rojas",
              rut: "89.012.345-6",
              diagnostico: "Migraña",
              dias: 1,
              fechaInicio: "2024-01-17",
              fechaFin: "2024-01-17",
              estado: "vigente",
              medico: "Dra. López",
              especialidad: "Neurología"
            },
            {
              id: 9,
              paciente: "Roberto Díaz",
              rut: "90.123.456-7",
              diagnostico: "Fractura Menor",
              dias: 14,
              fechaInicio: "2024-01-01",
              fechaFin: "2024-01-14",
              estado: "vencido",
              medico: "Dr. Rodríguez",
              especialidad: "Traumatología"
            },
            {
              id: 10,
              paciente: "Patricia Morales",
              rut: "01.234.567-8",
              diagnostico: "Faringitis",
              dias: 2,
              fechaInicio: "2024-01-16",
              fechaFin: "2024-01-17",
              estado: "vigente",
              medico: "Dra. Martínez",
              especialidad: "Medicina General"
            }
          ]);

          const [filtroEstado, setFiltroEstado] = useState('todos');
          const [filtroEspecialidad, setFiltroEspecialidad] = useState('todas');
          const [busqueda, setBusqueda] = useState('');

          // Cálculos de estadísticas
          const stats = useMemo(() => {
            const total = certificados.length;
            const vigentes = certificados.filter(c => c.estado === 'vigente').length;
            const vencidos = certificados.filter(c => c.estado === 'vencido').length;
            const totalDias = certificados.reduce((sum, c) => sum + c.dias, 0);
            const promedioDias = (totalDias / total).toFixed(1);

            return {
              total,
              vigentes,
              vencidos,
              promedioDias
            };
          }, [certificados]);

          // Datos para gráficos
          const datosPorDiagnostico = useMemo(() => {
            const conteo = certificados.reduce((acc, cert) => {
              acc[cert.diagnostico] = (acc[cert.diagnostico] || 0) + 1;
              return acc;
            }, {});

            return Object.entries(conteo).map(([name, value]) => ({ name, value }));
          }, [certificados]);

          const datosPorEspecialidad = useMemo(() => {
            const conteo = certificados.reduce((acc, cert) => {
              acc[cert.especialidad] = (acc[cert.especialidad] || 0) + 1;
              return acc;
            }, {});

            return Object.entries(conteo).map(([name, value]) => ({ name, value }));
          }, [certificados]);

          const datosPorMedico = useMemo(() => {
            const conteo = certificados.reduce((acc, cert) => {
              acc[cert.medico] = (acc[cert.medico] || 0) + 1;
              return acc;
            }, {});

            return Object.entries(conteo)
              .map(([name, certificados]) => ({ name, certificados }))
              .sort((a, b) => b.certificados - a.certificados);
          }, [certificados]);

          const tendenciaDias = useMemo(() => {
            return certificados.map(cert => ({
              fecha: cert.fechaInicio,
              dias: cert.dias,
              paciente: cert.paciente
            })).sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
          }, [certificados]);

          // Filtrado de certificados
          const certificadosFiltrados = useMemo(() => {
            return certificados.filter(cert => {
              const cumpleFiltroEstado = filtroEstado === 'todos' || cert.estado === filtroEstado;
              const cumpleFiltroEspecialidad = filtroEspecialidad === 'todas' || cert.especialidad === filtroEspecialidad;
              const cumpleBusqueda = busqueda === '' || 
                cert.paciente.toLowerCase().includes(busqueda.toLowerCase()) ||
                cert.rut.includes(busqueda) ||
                cert.diagnostico.toLowerCase().includes(busqueda.toLowerCase());

              return cumpleFiltroEstado && cumpleFiltroEspecialidad && cumpleBusqueda;
            });
          }, [certificados, filtroEstado, filtroEspecialidad, busqueda]);

          const especialidades = useMemo(() => {
            return [...new Set(certificados.map(c => c.especialidad))];
          }, [certificados]);

          const COLORS = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#14B8A6', '#F97316'];

          const exportarDatos = () => {
            const csvContent = [
              ['ID', 'Paciente', 'RUT', 'Diagnóstico', 'Días', 'Fecha Inicio', 'Fecha Fin', 'Estado', 'Médico', 'Especialidad'],
              ...certificadosFiltrados.map(cert => [
                cert.id,
                cert.paciente,
                cert.rut,
                cert.diagnostico,
                cert.dias,
                cert.fechaInicio,
                cert.fechaFin,
                cert.estado,
                cert.medico,
                cert.especialidad
              ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'certificados.csv';
            a.click();
          };

          return (
            <div className="min-h-screen bg-gray-50 p-6">
              {/* Header */}
              <div className="mb-8">
                <h1 className="text-3xl font-bold text-gray-800 mb-2">Dashboard de Certificados Médicos</h1>
                <p className="text-gray-600">Sistema de gestión y análisis de licencias médicas</p>
              </div>

              {/* Tarjetas de Estadísticas */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div className="bg-white rounded-lg shadow p-6">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-blue-100 rounded-lg">
                      <Users className="text-blue-600" size={24} />
                    </div>
                    <span className="text-2xl font-bold text-gray-800">{stats.total}</span>
                  </div>
                  <h3 className="text-gray-600 text-sm font-medium">Total Certificados</h3>
                </div>

                <div className="bg-white rounded-lg shadow p-6">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-green-100 rounded-lg">
                      <CheckCircle className="text-green-600" size={24} />
                    </div>
                    <span className="text-2xl font-bold text-gray-800">{stats.vigentes}</span>
                  </div>
                  <h3 className="text-gray-600 text-sm font-medium">Certificados Vigentes</h3>
                </div>

                <div className="bg-white rounded-lg shadow p-6">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-red-100 rounded-lg">
                      <AlertCircle className="text-red-600" size={24} />
                    </div>
                    <span className="text-2xl font-bold text-gray-800">{stats.vencidos}</span>
                  </div>
                  <h3 className="text-gray-600 text-sm font-medium">Certificados Vencidos</h3>
                </div>

                <div className="bg-white rounded-lg shadow p-6">
                  <div className="flex items-center justify-between mb-4">
                    <div className="p-3 bg-purple-100 rounded-lg">
                      <Clock className="text-purple-600" size={24} />
                    </div>
                    <span className="text-2xl font-bold text-gray-800">{stats.promedioDias}</span>
                  </div>
                  <h3 className="text-gray-600 text-sm font-medium">Promedio de Días</h3>
                </div>
              </div>

              {/* Gráficos */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                {/* Gráfico de Diagnósticos */}
                <div className="bg-white rounded-lg shadow p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">Certificados por Diagnóstico</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={datosPorDiagnostico}>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="name" angle={-45} textAnchor="end" height={100} fontSize={12} />
                      <YAxis />
                      <Tooltip />
                      <Bar dataKey="value" fill="#3B82F6" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>

                {/* Gráfico de Especialidades */}
                <div className="bg-white rounded-lg shadow p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">Distribución por Especialidad</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <PieChart>
                      <Pie
                        data={datosPorEspecialidad}
                        cx="50%"
                        cy="50%"
                        labelLine={false}
                        label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                        outerRadius={80}
                        fill="#8884d8"
                        dataKey="value"
                      >
                        {datosPorEspecialidad.map((entry, index) => (
                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                        ))}
                      </Pie>
                      <Tooltip />
                    </PieChart>
                  </ResponsiveContainer>
                </div>

                {/* Gráfico de Médicos */}
                <div className="bg-white rounded-lg shadow p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">Certificados por Médico</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={datosPorMedico} layout="vertical">
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis type="number" />
                      <YAxis dataKey="name" type="category" width={100} fontSize={12} />
                      <Tooltip />
                      <Bar dataKey="certificados" fill="#10B981" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>

                {/* Tendencia de Días */}
                <div className="bg-white rounded-lg shadow p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">Tendencia de Días de Licencia</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <LineChart data={tendenciaDias}>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="fecha" fontSize={12} />
                      <YAxis />
                      <Tooltip />
                      <Line type="monotone" dataKey="dias" stroke="#8B5CF6" strokeWidth={2} />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {/* Filtros y Búsqueda */}
              <div className="bg-white rounded-lg shadow p-6 mb-6">
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <Filter size={16} className="inline mr-2" />
                      Estado
                    </label>
                    <select
                      value={filtroEstado}
                      onChange={(e) => setFiltroEstado(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="todos">Todos</option>
                      <option value="vigente">Vigentes</option>
                      <option value="vencido">Vencidos</option>
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Especialidad
                    </label>
                    <select
                      value={filtroEspecialidad}
                      onChange={(e) => setFiltroEspecialidad(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="todas">Todas</option>
                      {especialidades.map(esp => (
                        <option key={esp} value={esp}>{esp}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Búsqueda
                    </label>
                    <input
                      type="text"
                      value={busqueda}
                      onChange={(e) => setBusqueda(e.target.value)}
                      placeholder="Paciente, RUT o diagnóstico..."
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>

                  <div className="flex items-end gap-2">
                    <button
                      onClick={() => {
                        setFiltroEstado('todos');
                        setFiltroEspecialidad('todas');
                        setBusqueda('');
                      }}
                      className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors flex items-center justify-center gap-2"
                    >
                      <RefreshCw size={16} />
                      Limpiar
                    </button>
                    <button
                      onClick={exportarDatos}
                      className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-2"
                    >
                      <Download size={16} />
                      Exportar
                    </button>
                  </div>
                </div>
              </div>

              {/* Tabla de Certificados */}
              <div className="bg-white rounded-lg shadow overflow-hidden">
                <div className="p-6 border-b border-gray-200">
                  <h3 className="text-lg font-semibold text-gray-800">
                    Lista de Certificados ({certificadosFiltrados.length})
                  </h3>
                </div>
                <div className="overflow-x-auto">
                  <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Paciente
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          RUT
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Diagnóstico
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Días
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Período
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Médico
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Especialidad
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Estado
                        </th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      {certificadosFiltrados.map((cert) => (
                        <tr key={cert.id} className="hover:bg-gray-50 transition-colors">
                          <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            {cert.paciente}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {cert.rut}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {cert.diagnostico}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {cert.dias}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {cert.fechaInicio} - {cert.fechaFin}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {cert.medico}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {cert.especialidad}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">
                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                              cert.estado === 'vigente' 
                                ? 'bg-green-100 text-green-800' 
                                : 'bg-red-100 text-red-800'
                            }`}>
                              {cert.estado === 'vigente' ? 'Vigente' : 'Vencido'}
                            </span>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          );
        };

        // Renderizar la aplicación
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DashboardCertificados />);
    </script>
</body>
</html>